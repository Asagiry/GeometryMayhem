name: Check

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  lint:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }} # –Ω—É–∂–Ω–æ –¥–ª—è –ø—É—à–∞

      - name: Install Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      - name: Install gdtoolkit
        run: pip install gdtoolkit

      - name: Auto format GDScript
        run: |
          gdformat .
          if [[ $(git status --porcelain) ]]; then
            echo "üîß Formatting changes detected. Committing..."
            git config user.name "github-actions[bot]"
            git config user.email "github-actions[bot]@users.noreply.github.com"
            git add .
            git commit -m "Auto-format GDScript code"
            git push
          else
            echo "‚úÖ No formatting changes needed."
          fi

      - name: Run gdlint (check for errors)
        run: gdlint .
